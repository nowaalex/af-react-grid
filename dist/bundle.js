"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react-draggable"),r=require("react"),n=e(r),i=e(require("react-dom")),o=e(require("prop-types")),a=e(require("classnames")),s=n.memo(function(e){var r=e.className,i=e.type,o=e.style,a=e.index,s=e.onDrag,c=e.onStart,u=e.disabled,l=e.children;return n.createElement(t.DraggableCore,{onStart:c,onDrag:s,disabled:u},n.createElement("div",{"data-resizer-index":a,"data-resizer-type":i,className:r,style:o,children:l}))});function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,r){return t&&u(e.prototype,t),r&&u(e,r),e}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?v(e):t}s.propTypes={type:o.oneOf(["row","col"]),onDrag:o.func,onStart:o.func,index:o.number,disabled:o.bool,children:o.node,style:o.object,className:o.string};var b="<|-aFrCtGrD-|>",y={row:{e:"react-rsz-grid-row",t:"pageX",r:"offsetWidth",n:"clientWidth",i:"width",o:"minWidth",a:"maxWidth",s:["Left","Right"]},col:{e:"react-rsz-grid-col",t:"pageY",r:"offsetHeight",n:"clientHeight",i:"height",o:"minHeight",a:"maxHeight",s:["Top","Bottom"]}},g=function(){function e(){var t=this;c(this,e);var r=localStorage.getItem(b);this.c=r?JSON.parse(r):{},window.addEventListener("beforeunload",function(){Object.keys(t.c).length>1&&localStorage.setItem(b,JSON.stringify(t.c))})}return l(e,[{key:"addStylesInfo",value:function(e,t){this.c[e]=t}},{key:"getStylesInfo",value:function(e){return this.c[e]||{}}}]),e}(),w=new g,D=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object.create(null);return function(r){return t[r]||(t[r]=e(r))}},S=function(e,t,r){return e>r?r:e<t?t:e},z=function(e,t,r){return e.hasOwnProperty(t)?e[t]:r};function N(e){if(!n.isValidElement(e))return e;var t=e.type,r=e.props,i=e.key,o=this.props,a=o.resizerChildren,c=o.type,u=o.localStorageKey,l=z(this.props,"resizerClassName","react-rsz-grid-default-resizer"),f=this.u;if(t===s)return n.cloneElement(e,{index:f,onDrag:this.l,onStart:this.f,type:c,className:z(r,"className",l)},z(r,"children",a));var h=i||b+f;this.h[f]=h;var d=this.state[h],m={style:r.style?Object.assign({},r.style,d):d,ref:this.d(f)};return t===O&&(m.resizerClassName=z(r,"resizerClassName",l),m.resizerChildren=z(r,"resizerChildren",a),m.localStorageKey=z(r,"localStorageKey",u+"_"+h)),this.u++,n.cloneElement(e,m)}var O=function(e){function t(){var e,r;c(this,t);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(r=p(this,(e=d(t)).call.apply(e,[this].concat(o)))).state=w.m(r.props.localStorageKey),r.v=[],r.h={},r.f=function(e){var t=r.p=+e.currentTarget.dataset.resizerIndex,n=r.v[t-1],i=r.v[t];if(n&&i){var o=y[r.props.type].t;r.b=e[o],r.y(n,1),r.y(i,2);var a=r._curD1+r._curD2;r._maxD1||(r._maxD1=a-r._minD2),r._maxD2||(r._maxD2=a-r._minD1),r.g()}else"production"!==process.env.NODE_ENV&&console.warn("Resizer must be between other components. It is inactive during this drag.")},r.l=function(e){var t=r.p;if(r.v[t]&&r.v[t-1]){var n=y[r.props.type],i=n.t,o=n.i,a=e[i]-r.b;r.setState(function(e){return r.w(e,o,a)})}},r.d=D(function(e){return function(t){r.v[e]=i.findDOMNode(t),"production"===process.env.NODE_ENV||!r.v[e]||r.v[e]instanceof Element||__JEST__||console.error("af-react-grid: can't find ref for component:",t,"ReactDOM.findDomNode must return element for all children of Container.")}}),r.D=function(e,t){var n=t.type,i=y[n],o=i.i,a=i.r;return r.v.reduce(function(t,n,i){var s,c=r.h[i];n&&(t[c]=Object.assign({},e[c],(f(s={},o,n[a]),f(s,"flexBasis","auto"),f(s,"boxSizing","border-box"),s)));return t},{})},r.g=function(){return r.setState(r.D)},r}return h(t,n.Component),l(t,[{key:"_setInitialDimensionsCache",value:function(e,t){var r=this.props.type,n=y[r],i=n.a,o=n.o,a=n.r,s=n.n,c=n.s,u=getComputedStyle(e),l=(this["_curD"+t]=e[a])-e[s]+c.reduce(function(e,t){return e+parseFloat(u["padding".concat(t)])},0);this["_minD"+t]=l+(parseFloat(u[o])||0),this["_maxD"+t]=parseFloat(u[i])||0}},{key:"sendToStateSaverIfNeeded",value:function(){var e=this.props.localStorageKey;e&&w.S(e,this.state)}},{key:"_getChangedState",value:function(e,t,r){var n,i=this.p,o=this.h[i],a=this.h[i-1];return f(n={},a,Object.assign({},e[a],f({},t,S(this._curD1+r,this._minD1,this._maxD1)))),f(n,o,Object.assign({},e[o],f({},t,S(this._curD2-r,this._minD2,this._maxD2)))),n}},{key:"render",value:function(){var e=this.props,t=e.type,i=e.className,o=e.children,s=e.style;return this.u=0,n.createElement("div",{style:s,className:a(i,y[t].e),children:r.Children.map(o,N,this)})}},{key:"componentDidMount",value:function(){this._st=setTimeout(this.g,50),window.addEventListener("resize",this.g)}},{key:"componentDidUpdate",value:function(){this.z();var e=this.v.length-this.u;e&&this.v.splice(this.u,e)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.g),clearTimeout(this._st)}}]),t}();O.propTypes={type:o.oneOf(["row","col"]),className:o.string,style:o.object,children:function(e,t){if(r.Children.toArray(e[t]).some(function(e){return n.isValidElement(e)&&e.type===n.Fragment}))throw new Error("Fragments are not allowed inside Container, use arrays instead")},resizerChildren:o.node,resizerClassName:o.string,localStorageKey:o.string},O.defaultProps={type:"row"},exports.Resizer=s,exports.Container=O;
